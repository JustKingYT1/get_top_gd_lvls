# .github/workflows/update_demonlist.yml
name: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Demonlist

on:
  schedule:
    - cron: '0 5 * * *'
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Install Playwright browsers and dependencies
        # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —É–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç xvfb, —Ç–∞–∫ —á—Ç–æ –æ–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
        run: playwright install --with-deps

      # --- –ò–ó–ú–ï–ù–ï–ù–ò–ï –¢–û–õ–¨–ö–û –ó–î–ï–°–¨ ---
      - name: Run data scraper with virtual display
        # –ú—ã –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç –≤–Ω—É—Ç—Ä–∏ "–æ–±–µ—Ä—Ç–∫–∏" xvfb-run
        run: xvfb-run python update_data.py
      # -------------------------------

      - name: Commit and push if data changed
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "chore(auto): üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Demonlist"
          file_pattern: data/demonlist.json